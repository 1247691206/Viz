!function(){var t={version:"1.0.0",template:{}};t.bP=function(){function t(n){f=n,n.each(function(){var n=d3.select(this),r=t.bars(),e=n.selectAll(".subBars").data(r.subBars).enter().append("rect").attr("class","subBars").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height});"undefined"!=typeof s&&e.style("fill",function(t){return s(t)});var a=n.selectAll(".edges").data(r.edges).enter().append("path").attr("class","edges").attr("d",function(t){return t.path}).style("fill-opacity",t.edgeOpacity());"undefined"!=typeof s&&a.style("fill",function(t){return s(t)}),n.selectAll(".mainBars").data(r.mainBars).enter().append("g").attr("class","mainBars").append("rect").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).on("mouseover",t.mouseover).on("mouseout",t.mouseout)})}var n,r,e,a,i,u,o,c,y,d,s,f,h;return t.data=function(n){return arguments.length?(d=n,t):d},t.fill=function(n){return arguments.length?(s=n,t):s},t.keyPrimary=function(r){return arguments.length?(n=r,t):"undefined"!=typeof n?n:function(t){return t[0]}},t.keySecondary=function(n){return arguments.length?(r=n,t):"undefined"!=typeof r?r:function(t){return t[1]}},t.value=function(n){return arguments.length?(e=n,t):"undefined"!=typeof e?e:function(t){return t[2]}},t.width=function(n){return arguments.length?(a=n,t):"undefined"!=typeof a?a:400},t.height=function(n){return arguments.length?(i=n,t):"undefined"!=typeof i?i:600},t.barSize=function(n){return arguments.length?(o=n,t):"undefined"!=typeof o?o:35},t.min=function(n){return arguments.length?(c=n,t):"undefined"!=typeof c?c:0},t.orient=function(n){return arguments.length?(u=n,t):"undefined"!=typeof u?u:"vertical"},t.pad=function(n){return arguments.length?(y=n,t):"undefined"!=typeof y?y:0},t.duration=function(n){return arguments.length?(duration=n,t):"undefined"!=typeof duration?duration:500},t.edgeOpacity=function(n){return arguments.length?(h=n,t):"undefined"!=typeof h?h:.4},t.bars=function(n){function r(t,r){return"undefined"==typeof n||n.part===r||d[n.part](t)===n.key}function e(){var n=t.min();c.primary.forEach(function(t){t.height<n&&(t.y=t.y+.5*(t.height-n),t.height=n)}),c.secondary.forEach(function(t){t.height<n&&(t.x=t.x+.5*(t.height-n),t.height=n)})}function a(n){function e(e){return r(e,n)?t.value()(e):0}var a=d3.nest().key("primary"==n?t.keyPrimary():t.keySecondary()).rollup(function(t){return d3.sum(t,e)}).entries(t.data()),i=o(a,t.pad(),t.min(),0,"vertical"==s?t.height():t.width()),u=t.barSize();a.forEach(function(r,e){c[n].push({x:"vertical"==s?"primary"==n?0:t.width()-u:i[e].s,y:"horizontal"==s?"primary"==n?0:t.height()-u:i[e].s,height:"vertical"==s?i[e].e-i[e].s:u,width:"horizontal"==s?i[e].e-i[e].s:u,part:n,key:r.key,value:r.value,percent:i[e].p})})}function i(n){function e(e){return r(e,n)?t.value()(e):0}var a=d3.map(c[n],function(t){return t.key}),i=d3.nest().key("primary"==n?t.keyPrimary():t.keySecondary()).key("secondary"==n?t.keyPrimary():t.keySecondary()).rollup(function(t){return d3.sum(t,e)}).entries(t.data());i.forEach(function(r){var e=a.get(r.key),i=o(r.values,0,0,"vertical"==s?e.y:e.x,"vertical"==s?e.y+e.height:e.x+e.width),u=t.barSize();r.values.forEach(function(a,o){y[n].push({x:"vertical"==s?"primary"==n?0:t.width()-u:i[o].s,y:"horizontal"==s?"primary"==n?0:t.height()-u:i[o].s,height:"vertical"==s?i[o].e-i[o].s:u,width:"horizontal"==s?i[o].e-i[o].s:u,part:n,primary:"primary"==n?r.key:a.key,secondary:"primary"==n?a.key:r.key,value:a.value,percent:i[o].p*e.percent,index:"primary"==n?r.key+"|"+a.key:a.key+"|"+r.key})})})}function u(){var t=d3.map(y.secondary,function(t){return t.index});return y.primary.map(function(n){var r=t.get(n.index);return{path:"vertical"===s?["M",n.x+n.width,",",n.y+n.height,"V",n.y,"L",r.x,",",r.y,"V",r.y+r.height,"Z"].join(""):["M",n.x,",",n.y+n.height,"H",n.x+n.width,"L",r.x+r.width,",",r.y,"H",r.x,"Z"].join(""),primary:n.primary,secondary:n.secondary,value:n.value,percent:n.percent}})}function o(t,n,r,e,a){var i=r/(a-e-2*t.length*n),u=0,o=0,c=d3.sum(t,function(t){return t.value});t.forEach(function(t){t.value<i*c&&(u+=1,o+=t.value)});var y=(a-e-2*t.length*n-u*r)/(0==c?1:c-o),d=e,s=[];return t.forEach(function(t){var e=t.value*y;s.push({s:d+n+(r>e?.5*(r-e):0),e:d+n+(r>e?.5*(r+e):e),p:t.value/c}),d+=2*n+(r>e?r:e)}),s}var c={primary:[],secondary:[]},y={primary:[],secondary:[]},d={primary:t.keyPrimary(),secondary:t.keySecondary()},s=t.orient();return a("primary"),a("secondary"),i("primary"),i("secondary"),e(),{mainBars:c.primary.concat(c.secondary),subBars:y.primary.concat(y.secondary),edges:u()}},t.mouseover=function(n){var r=t.bars(n);f.selectAll(".mainBars").filter(function(t){return t.part===n.part&&t.key===n.key}).style("stroke-opacity",1),f.selectAll(".subBars").data(r.subBars).transition().duration(t.duration()).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height});var e=f.selectAll(".edges").data(r.edges);e.filter(function(t){return t[n.part]===n.key}).transition().duration(t.duration()).style("fill-opacity",.5).attr("d",function(t){return t.path}),e.filter(function(t){return t[n.part]!==n.key}).transition().duration(t.duration()).style("fill-opacity",0).attr("d",function(t){return t.path}),f.selectAll(".mainBars").data(r.mainBars).transition().duration(t.duration()).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height})},t.mouseout=function(n){var r=t.bars();f.selectAll(".mainBars").filter(function(t){return t.part===n.part&&t.key===n.key}).style("stroke-opacity",0),f.selectAll(".subBars").data(r.subBars).transition().duration(t.duration()).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}),f.selectAll(".edges").data(r.edges).transition().duration(t.duration()).style("fill-opacity",t.edgeOpacity()).attr("d",function(t){return t.path}),f.selectAll(".mainBars").data(r.mainBars).transition().duration(t.duration()).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height})},t},this.viz=t}();