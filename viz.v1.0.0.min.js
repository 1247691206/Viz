!function(){var t={version:"1.0.0",template:{}};t.bP=function(){function t(i){g=i,i.each(function(){var i=d3.select(this),o=t.bars(),u=i.selectAll(".subBars").data(o.subBars).enter().append("g").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("class","subBars").append("rect").attr("x",e).attr("y",r).attr("width",n).attr("height",a);"undefined"!=typeof h&&u.style("fill",function(t){return h(t)});var s=i.selectAll(".edges").data(o.edges).enter().append("path").attr("class","edges").attr("d",function(t){return t.path}).style("fill-opacity",t.edgeOpacity());"undefined"!=typeof h&&s.style("fill",function(t){return h(t)}),i.selectAll(".mainBars").data(o.mainBars).enter().append("g").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("class","mainBars").append("rect").attr("x",e).attr("y",r).attr("width",n).attr("height",a).on("mouseover",t.mouseover).on("mouseout",t.mouseout)})}function e(t){return-t.width}function r(t){return-t.height}function n(t){return 2*t.width}function a(t){return 2*t.height}var i,o,u,s,d,l,c,f,p,y,h,g,m;return t.data=function(e){return arguments.length?(y=e,t):y},t.fill=function(e){return arguments.length?(h=e,t):h},t.keyPrimary=function(e){return arguments.length?(i=e,t):"undefined"!=typeof i?i:function(t){return t[0]}},t.keySecondary=function(e){return arguments.length?(o=e,t):"undefined"!=typeof o?o:function(t){return t[1]}},t.value=function(e){return arguments.length?(u=e,t):"undefined"!=typeof u?u:function(t){return t[2]}},t.width=function(e){return arguments.length?(s=e,t):"undefined"!=typeof s?s:400},t.height=function(e){return arguments.length?(d=e,t):"undefined"!=typeof d?d:600},t.barSize=function(e){return arguments.length?(c=e,t):"undefined"!=typeof c?c:35},t.min=function(e){return arguments.length?(f=e,t):"undefined"!=typeof f?f:0},t.orient=function(e){return arguments.length?(l=e,t):"undefined"!=typeof l?l:"vertical"},t.pad=function(e){return arguments.length?(p=e,t):"undefined"!=typeof p?p:0},t.duration=function(e){return arguments.length?(duration=e,t):"undefined"!=typeof duration?duration:500},t.edgeOpacity=function(e){return arguments.length?(m=e,t):"undefined"!=typeof m?m:.4},t.bars=function(e){function r(t,r){return"undefined"==typeof e||e.part===r||l[e.part](t)===e.key}function n(){var e=t.min()/2;s.primary.forEach(function(t){t.height<e&&(t.height=e)}),s.secondary.forEach(function(t){t.height<e&&(t.height=e)})}function a(e){function n(n){return r(n,e)?t.value()(n):0}var a=d3.nest().key("primary"==e?t.keyPrimary():t.keySecondary()).rollup(function(t){return d3.sum(t,n)}).entries(t.data()),i=u(a,t.pad(),t.min(),0,"vertical"==c?t.height():t.width()),o=t.barSize();a.forEach(function(r,n){s[e].push({x:"horizontal"==c?(i[n].s+i[n].e)/2:"primary"==e?o/2:t.width()-o/2,y:"vertical"==c?(i[n].s+i[n].e)/2:"primary"==e?o/2:t.height()-o/2,height:"vertical"==c?(i[n].e-i[n].s)/2:o/2,width:"horizontal"==c?(i[n].e-i[n].s)/2:o/2,part:e,key:r.key,value:r.value,percent:i[n].p})})}function i(e){function n(n){return r(n,e)?t.value()(n):0}var a=d3.map(s[e],function(t){return t.key}),i=d3.nest().key("primary"==e?t.keyPrimary():t.keySecondary()).key("secondary"==e?t.keyPrimary():t.keySecondary()).rollup(function(t){return d3.sum(t,n)}).entries(t.data());i.forEach(function(r){var n=a.get(r.key),i=u(r.values,0,0,"vertical"==c?n.y-n.height:n.x-n.width,"vertical"==c?n.y+n.height:n.x+n.width),o=t.barSize();r.values.forEach(function(a,u){d[e].push({x:"vertical"==c?"primary"==e?o/2:t.width()-o/2:(i[u].s+i[u].e)/2,y:"horizontal"==c?"primary"==e?o/2:t.height()-o/2:(i[u].s+i[u].e)/2,height:("vertical"==c?i[u].e-i[u].s:o)/2,width:("horizontal"==c?i[u].e-i[u].s:o)/2,part:e,primary:"primary"==e?r.key:a.key,secondary:"primary"==e?a.key:r.key,value:a.value,percent:i[u].p*n.percent,index:"primary"==e?r.key+"|"+a.key:a.key+"|"+r.key})})})}function o(){var t=d3.map(d.secondary,function(t){return t.index});return d.primary.map(function(e){var r=t.get(e.index);return{path:"vertical"===c?["M",e.x+e.width,",",e.y+e.height,"V",e.y-e.height,"L",r.x-r.width,",",r.y-r.height,"V",r.y+r.height,"Z"].join(""):["M",e.x-e.width,",",e.y+e.height,"H",e.x+e.width,"L",r.x+r.width,",",r.y-r.height,"H",r.x-r.width,"Z"].join(""),primary:e.primary,secondary:e.secondary,value:e.value,percent:e.percent}})}function u(t,e,r,n,a){var i=r/(a-n-2*t.length*e),o=0,u=0,s=d3.sum(t,function(t){return t.value});t.forEach(function(t){t.value<i*s&&(o+=1,u+=t.value)});var d=1e-5>s?0:(a-n-2*t.length*e-o*r)/(s-u),l=n,c=[];return t.forEach(function(t){var n=t.value*d;c.push({s:l+e+(r>n?.5*(r-n):0),e:l+e+(r>n?.5*(r+n):n),p:1e-5>s?0:t.value/s}),l+=2*e+(r>n?r:n)}),c}var s={primary:[],secondary:[]},d={primary:[],secondary:[]},l={primary:t.keyPrimary(),secondary:t.keySecondary()},c=t.orient();return a("primary"),a("secondary"),i("primary"),i("secondary"),n(),{mainBars:s.primary.concat(s.secondary),subBars:d.primary.concat(d.secondary),edges:o()}},t.mouseover=function(i){var o=t.bars(i);g.selectAll(".mainBars").filter(function(t){return t.part===i.part&&t.key===i.key}).select("rect").style("stroke-opacity",1),g.selectAll(".subBars").data(o.subBars).transition().duration(t.duration()).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("rect").attr("x",e).attr("y",r).attr("width",n).attr("height",a);var u=g.selectAll(".edges").data(o.edges);u.filter(function(t){return t[i.part]===i.key}).transition().duration(t.duration()).style("fill-opacity",.5).attr("d",function(t){return t.path}),u.filter(function(t){return t[i.part]!==i.key}).transition().duration(t.duration()).style("fill-opacity",0).attr("d",function(t){return t.path}),g.selectAll(".mainBars").data(o.mainBars).transition().duration(t.duration()).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("rect").attr("x",e).attr("y",r).attr("width",n).attr("height",a)},t.mouseout=function(i){var o=t.bars();g.selectAll(".mainBars").filter(function(t){return t.part===i.part&&t.key===i.key}).select("rect").style("stroke-opacity",0),g.selectAll(".subBars").data(o.subBars).transition().duration(t.duration()).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("rect").attr("x",e).attr("y",r).attr("width",n).attr("height",a),g.selectAll(".edges").data(o.edges).transition().duration(t.duration()).style("fill-opacity",t.edgeOpacity()).attr("d",function(t){return t.path}),g.selectAll(".mainBars").data(o.mainBars).transition().duration(t.duration()).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).select("rect").attr("x",e).attr("y",r).attr("width",n).attr("height",a)},t},t.gg=function(){function t(e){g=e,e.each(function(){var e=d3.select(this),r=t.domain(),n=t.scale(),a=t.inTick(),i=t.outTick(),o=t.outerRadius(),u=d3.range(r[0],r[1]+1,2);e.append("circle").attr("r",o).style("fill","url(#vizgg03)").attr("class","vizggouter"),e.append("circle").attr("r",t.innerRadius()).style("fill","url(#vizgg02)").style("filter","url(#vizgg05)");var s=e.append("g").style("stroke",t.tickColor());s.selectAll("line").data(u).enter().append("line").style("stroke-width","2").attr("x1",function(t){return o*(1-a)*Math.cos(n(t))}).attr("y1",function(t){return o*(1-a)*Math.sin(n(t))}).attr("x2",function(t){return.95*o*Math.cos(n(t))}).attr("y2",function(t){return.95*o*Math.sin(n(t))}),s.selectAll("line").filter(function(t){return t%10===0}).style("stroke-width","3").attr("x1",function(t){return o*(1-i)*Math.cos(n(t))}).attr("y1",function(t){return o*(1-i)*Math.sin(n(t))}),e.selectAll("text").data(u.filter(function(t){return t%10===0})).enter().append("text").attr("class","vizggtext").attr("x",function(t){return o*(1-a)*.8*Math.cos(n(t))}).attr("y",function(t){return o*(1-a)*.8*Math.sin(n(t))}).attr("dy",3).text(function(t){return t});var d=t.outerRadius()/f.outerRadius,l=180*t.scale()(t.value())/Math.PI+90;e.append("g").attr("transform","translate(1,1)").selectAll(".needleshadow").data([0]).enter().append("g").attr("transform","rotate("+l+")").attr("class","needleshadow").append("path").attr("d",["m 0",-130*d,5*d,175*d,-10*d,"0,z"].join(",")).style("filter","url(#vizgg06)"),e.selectAll(".needle").data([0]).enter().append("g").attr("transform","rotate("+l+")").attr("class","needle").append("polygon").attr("points",[-.5*d,-130*d,.5*d,-130*d,5*d,45*d,-5*d,45*d].join(",")).style("fill","url(#vizgg04)")})}var e,r,n,a,i,o,u,s,d,l,c,f={innerRadius:20,outerRadius:150,angleOffset:.7,startAngle:-1.5*Math.PI,endAngle:.5*Math.PI,inTick:.12,outTick:.2,needleColor:"#de2c2c",innerFaceColor:"#999999",faceColor:"#666666",tickColor:"#ffffff",domain:[0,100],duration:500,ease:"cubicInOut"};return t.scale=function(){return d3.scale.linear().domain(t.domain()).range([f.startAngle+t.angleOffset(),f.endAngle-t.angleOffset()])},t.innerRadius=function(r){return arguments.length?(e=r,t):"undefined"!=typeof e?e:f.innerRadius},t.outerRadius=function(e){return arguments.length?(r=e,t):"undefined"!=typeof r?r:f.outerRadius},t.angleOffset=function(e){return arguments.length?(d=e,t):"undefined"!=typeof d?d:f.angleOffset},t.inTick=function(e){return arguments.length?(inTick=e,t):"undefined"!=typeof inTick?inTick:f.inTick},t.outTick=function(e){return arguments.length?(outTick=e,t):"undefined"!=typeof outTick?outTick:f.outTick},t.needleColor=function(e){return arguments.length?(n=e,t):"undefined"!=typeof n?n:f.needleColor},t.innerFaceColor=function(e){return arguments.length?(a=e,t):"undefined"!=typeof a?a:f.innerFaceColor},t.tickColor=function(e){return arguments.length?(o=e,t):"undefined"!=typeof o?o:f.tickColor},t.faceColor=function(e){return arguments.length?(i=e,t):"undefined"!=typeof i?i:f.faceColor},t.domain=function(e){return arguments.length?(u=e,t):"undefined"!=typeof u?u:f.domain},t.duration=function(e){return arguments.length?(l=e,t):"undefined"!=typeof l?l:f.duration},t.ease=function(e){return arguments.length?(c=e,t):"undefined"!=typeof c?c:f.ease},t.value=function(e){return arguments.length?(s=e,t):"undefined"!=typeof s?s:.5*(f.domain[0]+f.domain[1])},t.defs=function(e){var r=e.append("defs"),n=r.append("linearGradient").attr("id","vizgg01"),a=t.needleColor();n.append("stop").attr("offset","0").style("stop-color",a),n.append("stop").attr("offset","1").style("stop-color",d3.rgb(a).darker(1));var i=r.append("radialGradient").attr("fx","35%").attr("fy","65%").attr("r","65%").attr("spreadMethod","pad").attr("id","vizgg02"),o=t.innerFaceColor();i.append("stop").attr("offset","0").style("stop-color",o),i.append("stop").attr("offset","1").style("stop-color",d3.rgb(o).darker(2));var u=r.append("radialGradient").attr("fx","35%").attr("fy","65%").attr("r","65%").attr("spreadMethod","pad").attr("id","vizgg03"),s=t.faceColor();u.append("stop").attr("offset","0").style("stop-color",s),u.append("stop").attr("offset","1").style("stop-color",d3.rgb(s).darker(2)),r.append("linearGradient").attr("gradientUnits","userSpaceOnUse").attr("y1","80").attr("x1","-10").attr("y2","80").attr("x2","10").attr("id","vizgg04").attr("xlink:href","#vizgg01");var d=r.append("filter").attr("id","vizgg05");d.append("feFlood").attr("result","flood").attr("flood-color","rgb(0,0,0)").attr("flood-opacity","0.6"),d.append("feComposite").attr("result","composite1").attr("operator","in").attr("in2","SourceGraphic").attr("in","flood"),d.append("feGaussianBlur").attr("result","blur").attr("stdDeviation","2").attr("in","composite1"),d.append("feOffset").attr("result","offset").attr("dy","2").attr("dx","2"),d.append("feComposite").attr("result","composite2").attr("operator","over").attr("in2","offset").attr("in","SourceGraphic");var l=r.append("filter").attr("x","-0.3").attr("y","-0.3").attr("height","1.8").attr("width","1.8").attr("id","vizgg06");l.append("feGaussianBlur").attr("stdDeviation","2")},t.setNeedle=function(e){function r(t,e){return d3.interpolateString("rotate("+t+")","rotate("+e+")")}var n=180*t.scale()(e)/Math.PI+90,a=180*t.scale()(t.value())/Math.PI+90,i=d3.ease(t.ease());g.selectAll(".needle").data([e]).transition().duration(t.duration()).attrTween("transform",function(t){return r(a,n)}).ease(i),g.selectAll(".needleshadow").data([e]).transition().duration(t.duration()).attrTween("transform",function(t){return r(a,n)}).ease(i).each("end",function(){angle=e}),t.value(e)},t},this.viz=t}();